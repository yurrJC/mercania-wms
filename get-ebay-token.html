<!DOCTYPE html>
<html>
<head>
    <title>eBay OAuth 2.0 Token Generator</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .container { max-width: 600px; }
        .step { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .code { background: #f5f5f5; padding: 10px; border-radius: 3px; font-family: monospace; }
        button { background: #0070ba; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #005a9e; }
        input { width: 100%; padding: 8px; margin: 5px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîë eBay OAuth 2.0 Token Generator</h1>
        
        <div class="step">
            <h3>Step 1: Get Your App Credentials</h3>
            <p>Go to <a href="https://developer.ebay.com/my/keys" target="_blank">eBay Developer Console</a> and get:</p>
            <input type="text" id="appId" placeholder="App ID (Client ID)" />
            <input type="text" id="clientSecret" placeholder="Client Secret" />
        </div>

        <div class="step">
            <h3>Step 2: Generate Authorization URL</h3>
            <button onclick="generateAuthUrl()">Generate Authorization URL</button>
            <div id="authUrl" style="margin-top: 10px;"></div>
        </div>

        <div class="step">
            <h3>Step 3: Get Authorization Code</h3>
            <p>Click the URL above, sign in to eBay, and copy the authorization code from the redirect URL.</p>
            <input type="text" id="authCode" placeholder="Authorization Code" />
        </div>

        <div class="step">
            <h3>Step 4: Exchange for Access Token</h3>
            <button onclick="getAccessToken()">Get Access Token</button>
            <div id="tokenResult" style="margin-top: 10px;"></div>
        </div>
    </div>

    <script>
        function generateAuthUrl() {
            const appId = document.getElementById('appId').value;
            if (!appId) {
                alert('Please enter your App ID first');
                return;
            }
            
            const redirectUri = 'https://developer.ebay.com/my/keys';
            const scope = 'https://api.ebay.com/oauth/api_scope/commerce.catalog.readonly https://api.ebay.com/oauth/api_scope/commerce.catalog.read';
            const state = 'mercania-wms';
            
            const authUrl = `https://auth.ebay.com/oauth2/authorize?client_id=${appId}&response_type=code&redirect_uri=${encodeURIComponent(redirectUri)}&scope=${encodeURIComponent(scope)}&state=${state}`;
            
            document.getElementById('authUrl').innerHTML = `
                <p><strong>Click this URL to authorize:</strong></p>
                <a href="${authUrl}" target="_blank" style="word-break: break-all;">${authUrl}</a>
            `;
        }

        async function getAccessToken() {
            const appId = document.getElementById('appId').value;
            const clientSecret = document.getElementById('clientSecret').value;
            const authCode = document.getElementById('authCode').value;
            
            if (!appId || !clientSecret || !authCode) {
                alert('Please fill in all fields');
                return;
            }

            try {
                const response = await fetch('https://api.ebay.com/identity/v1/oauth2/token', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                        'Authorization': `Basic ${btoa(appId + ':' + clientSecret)}`
                    },
                    body: `grant_type=authorization_code&code=${authCode}&redirect_uri=https://developer.ebay.com/my/keys`
                });

                const data = await response.json();
                
                if (data.access_token) {
                    document.getElementById('tokenResult').innerHTML = `
                        <div style="background: #d4edda; padding: 10px; border-radius: 3px; margin: 10px 0;">
                            <h4>‚úÖ Success! Your Access Token:</h4>
                            <div class="code">${data.access_token}</div>
                            <p><strong>Add this to your Render environment variables as:</strong></p>
                            <div class="code">EBAY_USER_TOKEN = ${data.access_token}</div>
                        </div>
                    `;
                } else {
                    document.getElementById('tokenResult').innerHTML = `
                        <div style="background: #f8d7da; padding: 10px; border-radius: 3px;">
                            <h4>‚ùå Error:</h4>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>
                    `;
                }
            } catch (error) {
                document.getElementById('tokenResult').innerHTML = `
                    <div style="background: #f8d7da; padding: 10px; border-radius: 3px;">
                        <h4>‚ùå Error:</h4>
                        <pre>${error.message}</pre>
                    </div>
                `;
            }
        }
    </script>
</body>
</html>
